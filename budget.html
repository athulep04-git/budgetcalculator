<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Smart Budget</title>
  <link rel="shortcut icon" href="https://static.vecteezy.com/system/resources/previews/011/107/367/original/wallet-3d-icon-illustration-png.png" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-cover bg-center bg-no-repeat" style="background-image: url('https://cdn.pixabay.com/photo/2017/02/18/17/03/light-background-2077664_1280.jpg');">

  <nav class="fixed top-0 left-0 w-full bg-blue-600 shadow-md px-8 py-4 flex justify-between items-center z-50">
    <div class="flex items-center space-x-2">
      <img src="https://www.pngmart.com/files/8/Wallet-PNG-Transparent-File.png" class="h-6">
      <span class="text-2xl font-bold text-white">Smart Budget</span>
    </div>
    <div>
      <button onclick="logout()" class="bg-red-500 px-4 py-2 text-white font-bold rounded-lg hover:bg-red-700">Logout</button>
    </div>
  </nav>

  <div class="bg-white rounded-lg shadow-lg p-10 max-w-4xl mt-32 mx-auto border border-gray-100">
    <h2 class="text-2xl font-bold text-blue-600 mb-2">Smart Budget Dashboard</h2>
    <h3 id="welcomeMsg" class="text-lg font-semibold mb-6"></h3>

    <div class="bg-gray-100 p-6 rounded-lg shadow-md text-center mb-6">
      <h2 class="text-xl font-bold text-blue-700 mb-4">Summary</h2>
      <p class="text-lg text-green-700 font-semibold">Total Income: ₹<span id="totalIncome">0</span></p>
      <p class="text-lg text-red-700 font-semibold">Total Expense: ₹<span id="totalExpense">0</span></p>
      <div id="categoryBreakdown" class="text-left mt-2 mb-2"></div>
      <p class="text-lg text-gray-800 font-bold">Balance: ₹<span id="balanceSummary">0</span></p>
    </div>

    <div class="grid md:grid-cols-2 gap-8">
      <div>
        <h2 class="text-xl font-semibold mb-4">Add Transaction</h2>
        <div class="mb-4">
          <label class="block text-gray-600 mb-1">Amount (₹)</label>
          <input type="number" id="amount" placeholder="Enter amount" class="w-full border p-2 rounded">
        </div>
        <div class="mb-4">
          <label class="block text-gray-600 mb-1">Description</label>
          <input type="text" id="description" placeholder="Enter description" class="w-full border p-2 rounded">
        </div>
        <div class="mb-4">
          <label class="block text-gray-600 mb-1">Expense Type (for expenses only)</label>
          <select id="expenseType" class="w-full border p-2 rounded">
            <option value="">-- Select Category --</option>
            <option value="Rent">Rent</option>
            <option value="Groceries">Groceries</option>
            <option value="Transportation">Transportation</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Other">Other Expenses</option>
          </select>
        </div>
        <div class="flex space-x-4">
          <button onclick="addIncome()" class="flex-1 bg-green-600 text-white p-2 rounded hover:bg-green-700">Add Income</button>
          <button onclick="addExpense()" class="flex-1 bg-red-600 text-white p-2 rounded hover:bg-red-700">Add Expense</button>
        </div>
      </div>
      <div>
        <h2 class="text-xl font-semibold mb-4">History</h2>
        <ul id="history" class="list-disc pl-6 text-gray-700 space-y-1"></ul>
      </div>
    </div>
  </div>

  <script>
    let userData = JSON.parse(localStorage.getItem("userdata"));
    if (!userData) {
      alert("Please log in first!");
      window.location.href = "login.html";
    }
    document.getElementById("welcomeMsg").innerText = "Welcome, " + userData.first;

    let balance = parseFloat(localStorage.getItem("balance")) || 0;
    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    let totalIncome = parseFloat(localStorage.getItem("totalIncome")) || 0;
    let totalExpense = parseFloat(localStorage.getItem("totalExpense")) || 0;
    let categoryTotals = JSON.parse(localStorage.getItem("categoryTotals")) || {
      Rent: 0, Groceries: 0, Transportation: 0, Entertainment: 0, Other: 0
    };

    function renderHistory() {
      const historyList = document.getElementById("history");
      historyList.innerHTML = "";
      transactions.forEach((tx) => {
        let li = document.createElement("li");
        if (tx.type === "Expense") {
          li.innerHTML = `₹${tx.amount} - ${tx.desc} 
                          <span class="text-gray-500 text-sm">(${tx.category}, ${tx.date})</span>`;
          li.className = "text-red-700";
        } else {
          li.innerHTML = `₹${tx.amount} - ${tx.desc} 
                          <span class="text-gray-500 text-sm">(${tx.date})</span>`;
          li.className = "text-green-700";
        }
        historyList.appendChild(li);
      });
    }

    function renderSummary() {
      document.getElementById("totalIncome").innerText = totalIncome;
      document.getElementById("totalExpense").innerText = totalExpense;
      document.getElementById("balanceSummary").innerText = balance;
      let breakdownHTML = "";
      for (let category in categoryTotals) {
        if (categoryTotals[category] > 0) {
          breakdownHTML += `<p class="text-sm text-red-700">${category}: ₹${categoryTotals[category]}</p>`;
        }
      }
      document.getElementById("categoryBreakdown").innerHTML = breakdownHTML;
    }

    function addIncome() {
      let amount = parseFloat(document.getElementById("amount").value);
      let desc = document.getElementById("description").value;
      if (!amount || amount <= 0 || !desc) {
        alert("Please enter valid amount and description.");
        return;
      }
      balance += amount;
      totalIncome += amount;
      transactions.push({ type: "Income", amount, desc, date: new Date().toLocaleString() });
      updateUI();
    }

    function addExpense() {
      let amount = parseFloat(document.getElementById("amount").value);
      let desc = document.getElementById("description").value;
      let category = document.getElementById("expenseType").value;
      if (!amount || amount <= 0 || !desc || !category) {
        alert("Please enter valid amount, description, and select category.");
        return;
      }
      balance -= amount;
      totalExpense += amount;
      categoryTotals[category] += amount;
      transactions.push({ type: "Expense", category, amount, desc, date: new Date().toLocaleString() });
      updateUI();
    }

    function updateUI() {
      localStorage.setItem("balance", balance);
      localStorage.setItem("transactions", JSON.stringify(transactions));
      localStorage.setItem("totalIncome", totalIncome);
      localStorage.setItem("totalExpense", totalExpense);
      localStorage.setItem("categoryTotals", JSON.stringify(categoryTotals));
      renderHistory();
      renderSummary();
      document.getElementById("amount").value = "";
      document.getElementById("description").value = "";
      document.getElementById("expenseType").value = "";
    }

    function logout() {
      localStorage.removeItem("balance");
      localStorage.removeItem("transactions");
      localStorage.removeItem("totalIncome");
      localStorage.removeItem("totalExpense");
      localStorage.removeItem("categoryTotals");
      alert("You have logged out!");
      window.location.href = "login.html";
    }

    renderHistory();
    renderSummary();
  </script>
</body>
</html>
